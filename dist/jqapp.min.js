/**
 * Jqapp
 * 
 * @author  Nick Tsai <myintaer@gmail.com>
 * @version 1.3.0
 * @see     https://github.com/yidas/jqapp
 */
!function(window,$){"use strict";var Instance=function(e){var t=this;if(e=e||{},this.$options=Object.freeze(e),this.$data=e.data||{},this.$el=null,this.$$el=null,this.$template=e.template||null,this.$components=e.components||{},this.$hooks={beforeCreate:e.beforeCreate||null,created:e.created||null,beforeMount:e.beforeMount||null,mounted:e.mounted||null,beforeDestroy:e.beforeDestroy||null,destroyed:e.destroyed||null},this.$root,"function"==typeof this.$hooks.beforeCreate&&this.$hooks.beforeCreate.bind(this)(),this.$data)for(var n in this.$data)this.$data.hasOwnProperty(n)&&(n in t?Helper.warn('Data "'+n+'" has already been defined as a reserved word.'):t[n]=this.$data[n]);if(e.methods)for(var n in e.methods)this.$data&&n in this.$data?Helper.warn('Method "'+n+'" has already been defined as a data property.'):n in t?Helper.warn('Method "'+n+'" has already been defined as a reserved word.'):t[n]=e.methods[n];return"function"==typeof this.$hooks.created&&this.$hooks.created.bind(this)(),e.el&&this.$mount(e.el),this};Instance.prototype.$mount=function(elementOrSelector){if(!elementOrSelector&&!this.$el&&!this.$template)return Helper.warn("Failed to mount component: el or template not defined."),!1;var el;if(el=elementOrSelector?Helper.queryElement(elementOrSelector):this.$el,!el&&!this.$template)return Helper.warn("Cannot find element: `"+elementOrSelector+"`"),!1;if(this.$template||Jqapp.config.compileElement){var template=this.$template?this.$template:el.outerHTML,html;if(0===template.indexOf("#")){var templateElement=document.querySelector(template);templateElement||Helper.error("`"+template+"`: template not found"),html=templateElement.innerHTML}else html=template;var regex=new RegExp("{{\\s?(.*?)\\s?}}","gi"),that=this;html=html.replace(regex,function(match,g1,offset,string){try{g1=g1.replace(";","");var result=eval("that."+g1);return result=void 0!==result?result:"","object"==typeof result?JSON.stringify(result):String(result)}catch(e){return""}for(var value=that,keys=g1.split("."),i=0;i<keys.length;i++){var key=keys[i];if("object"!=typeof value||!(key in value))return"";value=value[key]}return String(value)}),html=html.replace(new RegExp("\\\\{","g"),"{");var wrapper=document.createElement("div");wrapper.innerHTML=html.trim(),1!==wrapper.childElementCount&&Helper.error("template should contain exactly one root element.",!0);var templateElement=wrapper.firstChild;el&&el.parentNode.replaceChild(templateElement,el),el=templateElement}return"function"==typeof this.$hooks.beforeMount&&this.$hooks.beforeMount.bind(this)(),delete this.$el,delete this.$$el,this.$el=el,this.$$el=$?$(this.$el):null,Object.defineProperty(this,"el",{configurable:!0,writable:!1}),Object.defineProperty(this,"$el",{configurable:!0,writable:!1}),"function"==typeof this.$hooks.mounted&&this.$hooks.mounted.bind(this)(),this},Instance.prototype.$remove=function(){if("function"==typeof this.$hooks.beforeDestroy&&this.$hooks.beforeDestroy.bind(this)(),this.$el.parentNode){this.$el.parentNode.removeChild(this.$el),"function"==typeof this.$hooks.destroyed&&this.$hooks.destroyed.bind(this)();for(var e in this)delete this[e]}else Helper.warn("remove() failed");return this},Instance.prototype.$find=function(e){return this.$el.querySelector(e)},Instance.prototype.$createComponent=function(e,t){e||Helper.error("Component: First parameter `component key` required",!0),!e in this.$components&&Helper.error("Component: `"+e+"` not found",!0),t=t?$?$.extend(!0,{},this.$components[e],t):Helper.extend(!0,{},this.$components[e],t):this.$components[e];var n=new JqappComponent(t,e,this);return t.el||n.$mount(),n},Instance.prototype.$renderComponent=function(e,t){return this.$createComponent(e,t).$el},Instance.prototype.$shorthand=function(e,t,n,r,o,i){var a=n?this.$find(n):this.$el;if(!a)return Helper.warn(e+"(): Query selector `"+n+"` not found",!0),!1;var l=this.$renderComponent(r,o);return t.bind(this)(a,l),"function"==typeof i&&i.bind(this)(l),a},Instance.prototype.$append=function(e,t,n,r){return this.$shorthand("append",function(e,t){e.appendChild(t)},e,t,n,r)},Instance.prototype.$replace=function(e,t,n,r){return this.$shorthand("append",function(e,t){e.replaceChild(t,e)},e,t,n,r)},Instance.prototype.$html=function(e,t,n,r){return this.$shorthand("append",function(e,t){e.innerHTML="",e.appendChild(t)},e,t,n,r)},Instance.prototype.$$find=function(e){return Helper.jQueryRequired(),this.$$el.find(e)},Instance.prototype.$$renderComponent=function(e,t){return Helper.jQueryRequired(),this.$createComponent(e,t).$$el},Instance.prototype.$$shorthand=function(e,t,n,r,o,i){Helper.jQueryRequired();var a=this.$$find(n),l=this.$$renderComponent(r,o);return t.bind(this)(a,l),"function"==typeof i&&i.bind(this)(l),a},Instance.prototype.$$append=function(e,t,n,r){return this.$$shorthand("$append",function(e,t){e.append(t)},e,t,n,r)},Instance.prototype.$$replace=function(e,t,n,r){return this.$$shorthand("$replace",function(e,t){e.replaceWith(t)},e,t,n,r)},Instance.prototype.$$html=function(e,t,n,r){return this.$$shorthand("$html",function(e,t){e.html(t)},e,t,n,r)};var Jqapp=function(e){return Jqapp.config.jQuery&&!$&&Helper.error("jQuery is not loaded"),Instance.call(this,e),this.$root=this,this};Jqapp.prototype=Object.create(Instance.prototype),Jqapp.config={silent:!1,jQuery:!0,compileElement:!0};var JqappComponent=function(e,t,n){return e||Helper.error("Component `"+t+"`: invalid data"),e.template||Helper.error("Component `"+t+"`: template not defined"),Instance.call(this,e),this.$id=t,this.$parent=n,this.$root=n.$root,this};JqappComponent.prototype=Object.create(Instance.prototype);var Helper=new function(){this.queryElement=function(e){return e instanceof HTMLElement?e:$&&e instanceof $?e.get(0):document.querySelector(e)},this.jQueryRequired=function(){return $||this.error("jQuery is required",6),!0},this.error=function(e,t){e="[Jqapp] "+e;throw e=t?e+"\nAt"+this.getErrorCaller(t):e},this.warn=function(e){Jqapp.config.silent||console.error("[Jqapp Warn] "+e)},this.getErrorCaller=function(e){e=!isNaN(parseFloat(e))&&isFinite(e)?e:5;var t=function(){try{throw Error("")}catch(e){return e}}().stack.split("\n")[e];return t.slice(t.indexOf("at ")+2,t.length)},this.extend=function(){var e,t,n,r,o,i,a=arguments[0]||{},l=1,s=arguments.length,p=!1;if("boolean"==typeof a&&(p=a,a=arguments[l]||{},l++),"object"==typeof a||jQuery.isFunction(a)||(a={}),l===s)throw"Arguments required";for(;l<s;l++)if(null!=(e=arguments[l]))for(t in e)n=a[t],a!==(r=e[t])&&(p&&r&&("object"==typeof r||(o="[object Array]"===Object.prototype.toString.call(r)))?(o?(o=!1,i=n&&"[object Array]"===Object.prototype.toString.call(n)?n:[]):i=n&&"object"==typeof n?n:{},a[t]=this.extend(p,i,r)):void 0!==r&&(a[t]=r));return a}};window.Jqapp=Jqapp}(window,window.jQuery||null);